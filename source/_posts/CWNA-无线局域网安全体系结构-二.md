---
title: 'CWNA:无线局域网安全体系结构(二)'
date: 2022-02-28 17:31:28
tags: 'Wi-Fi'
---

### 强健安全机制
IEEE802.11-2016标准定义802.1X/EAP作为企业无线网络的身份验证机制；
定义预共享密钥或密码短语作为家用无线网络的身份验证机制。

**强健安全网络**
IEEE802.11-2016定义了强健安全网络（RSN）和强健安全网络关联（RSNA）。
两台终端必须验证彼此的身份并建立关联，且通过四次握手过程生成动态加密密钥，这个关联称为RSNA

**身份验证与授权**
身份验证必须先于授权进行。

**预共享密钥身份验证**
WPA/WPA2个人版支持最终用户输入长度为8~63个字符的简单ASCII字符串。

强健安全网络使用预共享密钥长度为256位，以十六进制则表示为64个字符。接入点和所有客户端都会配置预共享密钥，它是一种静态密钥。

系统的密码短语-预共享密钥映射（passphrase-to-PSK mapping)函数负责将密码短语转换位256位的预共享密钥。它旨在方便普通家庭
用户配置密码短语。

256位预共享密钥可以充当成对主密钥（PMK）。PMK位四次握手提供种子，四次握手用于生成动态加密密钥。因此，WPA/WPA2个人半使用的
预共享密钥实际上与PMK完全相同。

**专有预共享密钥身份验证**
WPA/WPA2的密码短语是静态的，很容易受社会工程学攻击。

专有预共享密钥身份验证位每个用户设置唯一的密码，为每个用户或每台设备提供唯一的预共享密钥功能。
如果摸一个预共享密钥泄漏，管理员只需撤销这一个密钥，不必重新配置所有接入点和最终用户设备。

**对等实体同时验证**
SAE交换期间，802.11终端之间不会传输密码短语。
它以蜻蜓密钥交换（Dragonfly key exchange）为基础，采用零知识证明（zero-knowledge proof）密钥交换，用户或设备必须在不透露
密码的情况下证明自己掌握密码。

**802.1X/EAP框架**
EAP类型众多，它是一种二层身份验证协议。
802.1X是基于端口的网络访问控制标准。既能用于无线环境，也能用于有线环境。

802.1X授权框架主要包括请求方，认证方、认证服务器3个要素。
请求方， 要求身份验证并访问网络资源的主机。 通常是手机或平板。
认证方， 允许或拒绝流量通过其端口的设备。 通常是接入点或无线局域网控制器。
认证服务器， 验证请求方提供的凭证，并将请求方是否获得授权的结果通知认证方。认证服务器一般是 RADIUS服务器。


802.1X/EAP帧交换过程

请求方---------------------------认证方----------------------------认证服务器
1. 802.11关联请求 --------------->    -------受控端口和非受控端口关闭---
2. EAPO-start ------------------>    --------受控端口和非受控端口关闭--
3. EAP-request/identity<---------    --------非受控端口开启-----------
4. EAP-response/identity---------> 5. RAIDUS-access-request--------->
7. EAP-challenge request<--------- 6. RADIUS-access-challenge------->
8. EAP-challenge response--------->9. RADIUS-access-request--------->
11. EAP-success<------------------10. RADIUS-access-accept<----------
12. 创建动态加密密钥的四次握手<----->
13. 受控端口开启，允许访问网络。

802.1X框架与EAP相互协作，提供验证用户和设备身份以及授权客户端访问网络资源的必要机制。

动态密钥的优点：
1. 不会受到社会工程学的攻击
2. 每位用户有一把不同且唯一的密钥。

**四次握手**

请求方----------------------------------------------------------------认证方
PMK已知---------------------------------------------------------------PMK已知
生成SNonce------------------------------------------------------------生成ANonce
Message 1: EAPOL-Key(ANonce, Unicast)<----------------------------------
派生PTK
Message 2: EAPOL-Key(SNonce, Unicast, MIC)----------------------------->
----------------------------------------------------------------------派生PTK，如果需要则生成GTK
Message 3: EAPOL-Key(Install PTK, Unicast, MIC, Encrypted GTK)<---------
Message 4: EAPL-Key(Unicast, MIC)-------------------------------------->
安装PTK和GTK-----------------------------------------------------------安装PTK

最终的密钥为成对瞬时密钥（PTK）和组临时密钥（GTK）。PTK用于加密解密单播流量；GTK用于加密解密广播和多播流量。

TKIP加密是正对WEP的加强版；CCMP加密优于TKIP；GCMP是更新的加密方式，无法向后兼容，接入点和客户端需要升级硬件。
