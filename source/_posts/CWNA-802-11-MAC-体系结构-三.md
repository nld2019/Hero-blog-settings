---
title: 'CWNA:802.11 MAC 体系结构(三)'
date: 2022-02-16 09:22:00
tags: 'Wi-Fi'
---
### 802.11状态机
802.11-2016定义了4种客户端状态，称为802.11状态机。旨在使得客户端和接入点能发现彼此并建安全连接。

主动扫描与被动扫描（active/passive scan）------     状态1：未通过验证未建立关联

802.11身份验证成功(authentication request/response) ------          状态2：已通过验证未建立关联

802.11（重）关联成功(association request/response) ------           状态3：已通过验证，已建立关联

四次握手成功(4-way handshake) ------               状态4：以通过验证，已建立关联


### 管理帧
IEEE802.11-2016定义了14种管理帧子类型
> 关联请求帧
> 关联响应帧
> 重关联请求帧
> 重关联响应帧
> 探询请求帧
> 探询响应帧
> 信标帧
> 通过流量指示消息
> 取消关联帧
> 身份验证帧
> 解除身份验证帧
> 行动帧
> 无确认行动帧
> 定时通告帧

**信标帧（Beacon)**
相当于无线网络的心跳消息。接入点利用信标帧向客户端通告基本服务集的所有配置信息。信标帧间隔102.4毫秒，每秒大约发送10次信标帧。
基本服务集中：接入点广播信标帧，客户端侦听信标帧。
IBSS中：客户端之间传输信标帧。

信标帧包含的信息

|信息类型|描述|
|:---:|:---:|
|时间戳|同步信息|
|扩频参数集|FHSS、OFDM等|
|SSID|无线局域网的逻辑名|
|数据速率|基本速率和支持速率|
|服务集功能|额外的BSS或IBSS参数|
|信道信息|接入点或IBSS使用的信道|
|流量指示图|节电过程使用的字段|
|BSS负载|802.11e指定的字段，能有效指示信道利用率|
|Qos功能|服务质量和增强型分布式信道访问信息|
|RSN功能|TKIP或CCMP密码信息和身份验证机制|
|HT与VHT功能|802.11n和802.11ac功能|
|供应商专有信息|特定于供应商的信息|

1.被动扫描
客户端必须发现接入点才能进行连接。
客户端进行被动扫描时，将侦听接入点不断发送的信标帧(Beacon)。

不足之处，信标帧仅在接入点使用的信道对外广播。

2.主动扫描
客户端发送探询帧，它既可以包括客户端正在查找的特定无线局域网的SSID，也可以搜索任何SSID。
探询帧SSID字段为空：查找所有可能的SSID
探询帧SSID字段存在：查找特定的SSID。

探询响应帧(probe request)，用于回复探询请求帧。（probe response)

主动扫描通过所有可用信道发送探询请求帧。

客户端即便已经关联到接入点并开始传输数据，客户端一般也会实施信道外扫描（off-channel scanning),并继续每隔几秒就利用其他信道发送探询请求帧。
主要目的是寻找可能漫游到其他接入点，通过off-channel scanning 客户端维护并更新一份已知接入点列表，从而在需要的时可以更快、更有效进行地漫游。

**身份验证帧（authentication）**
相当于验证两台设备是否是有效的802.11设备，客户端与接入点之间建立初步连接。802.11状态机进入状态2
两种身份验证机制：
1.共享密钥身份验证（早已过时）
2.开放系统身份验证
它不对客户端的身份做任何验证，本质是属于客户端与接入点之间的问候交换过程。

**关联帧(association)**
客户端向接入点验证自己的身份后，接下来将与接入点建立关联，关联到接入点的客户端称为基本服务集的成员。802.11状态机进入状态3
关联请求帧（association request）的关联响应帧（association response）的帧体包含管理标识符（AID），每个关联的客户端唯一。
如果不配做RSN安全，客户端可以请求IP地址并开始上层通信。
如果接入点配置了预共享密钥或802.1X/EAP作为身份验证机制，双方还需要进行四次握手(4-way handshake)的帧交换，以便创建动态加密密钥。802.11状态机进入状态4，成为基本服务集的成员。

如果客户端不能使用所有的基本速率，就无法关联到接入点，也不会获准加入基本服务集。

**重关联帧(reassociation)**
客户端与接入点的重关联过程：
1）客户端向新接入点发送重关联帧；
2）新接入点向客户端回复确认帧；
3）新接入点尝试利用分布介质（DSM）与原接入点通信，获取漫游客户端的信息，并请求接入点转发所有缓存数据。（这部分是供应商专有）
4）如果通信成功，原接入点将使用分布介质向新接入点转发所有缓冲数据。
5）新接入点通过无线介质向漫游客户端发送重关联响应帧。
6）客户端向新接入点回复确认帧，并准备漫游。
7）如果加密了，进行四次握手帧交换，以便在两个无线接口之间生成唯一的加密密钥。

**取消关联帧(deassociation)**
取消关联属于通知而非请求，包括原因代码。802.11状态机由4/3 切换到2

**解除身份验证帧(deauthentication)**
属于通知而非请求，包括原因代码。802.11状态机由4/3/2 切换到1

**行动帧(action)**
用于触发基本服务集的特定操作，旨在为准备执行的操作提供信息和指示。
由于管理帧的子类型已经耗尽，802.11h修正案首次引入行动帧。（Action)

Action帧结构

|帧控制|持续时间|目的地址|源地址|BSSID|序列控制|类别|行动|元素|FCS|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|2|2|6|6|6|2|1|1|varialble|4|

行动帧的帧体由3部分构成：
类别：描述行动帧的类型
操作：准备执行的操作
元素：添加有关操作的其他信息。

