---
title: 'CWNA:802.11 MAC 体系结构(二)'
date: 2022-02-15 10:03:56
tags: 'Wi-Fi'
---

### 802.11 MAC 帧头
MAC帧头属于二层信息，二层信息没有加密，可以通过协议分析仪查看内容。
MAC帧头由9个字段构成，4个字段用于寻址，5个字段用于控制

|帧控制|持续时间/ID|地址1|地址2|地址3|序列控制|地址4|QoS控制|HT控制|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|2字节|2|6|0 or 6|0 or 6|0 or 2|0 or 6|0 or 2|0 or 4|

**帧控制字段**

|协议版本|类型|子类型|发往DS|来自DS|更多分片|重试|电源管理|更多数据|受保护帧|+HTC/顺序|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|2|2|4|1|1|1|1|1|1|1|1|

目前协议版本只有一种，值为0
帧类型四种：
管理帧（00）， 发现接入点并加入基本服务集
控制帧（01）， 确认传输成功并保留无线介质
数据帧（10）， 携带上层MSDU净荷
扩展帧（11）， 一种新的灵活帧格式，仅用于802.11ad

由于帧类型多，类型和子类型字段共同决定帧类型，具体子类型可以抓控制包查看。


重试字段，802.11 MAC帧头中最重要的字段之一。
0：表示首次传输
1：表示重传
可以通过重试字段设置为1的管理帧和数据帧计算二层重传率。

受保护帧字段，标识数据帧的MSDU净荷是否加密。
0：未加密
1：加密


**持续时间/ID字段**
多数情况，持续时间字段用于虚载波监听，用来设置NAV的倒数计数器；
个别情况，遗留的电源管理，客户端利用节电轮询帧的持续时间/ID向接入点通过电源管理状态。

**MAC 寻址**
MAC地址分为两类：
单地址，分配给网络中唯一终端的地址
组地址，一个和多个终端使用的目的地址
多播地址，上层实体用于定义终端逻辑组的地址
广播地址，FF:FF:FF:FF:FF:FF

MAC地址6字节：
前三个字节，组织唯一标识符（OUI)
后三个字节，扩展标识符

源地址（SA)，原发终端的MAC地址；
目的地址(DA)，二层帧最终目的地的MAC地址；
发射机地址(TA)，发送端802.11无线接口的MAC地址
接收机地址(RA)，接收端802.11无线接口的MAC地址


**发往DS和来自DS字段**
00  常用于管理帧和控制帧
01  表示接入点向客户端发送802.11数据帧（下行传输）
10  表示客户端向接入点发送802.11数据帧（上行传输）
11  表示使用无线分布系统，需要4个地址，源和目的通过中间的发送和接收转接。

**序列控制字段**
两字节，在802.11 MSDU分片时使用。
分片总是在帧突发中传输，较小分片会降低数据吞吐量。
支持帧聚合和块确认的802.11n/ac网络不需要分片机制。

**Qos控制字段**
2字节，仅有Qos数据帧的帧头使用该字段。

**HT控制字段**
用于802.11n/ac发射机和接收机的链路自适应、发射波束成形等高级功能。

### 802.11 MAC 帧体
控制帧没有帧体。
802.11管理帧又称MAC管理协议数据单元（MMPDU），不携带任何上层信息。帧体包含二层信息字段和信息原始。帧体没有加密。
数据帧，携带上层信息，可以通过加密来保护。
null data的数据帧也没有帧体。特殊功能。


### 802.11 MAC 帧尾
携带整个帧数据完整性校验信息。
帧校验失败，将导致帧重传。
